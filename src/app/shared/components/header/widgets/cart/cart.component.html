<!-- Cart Style Basic -->
<app-button [type]="'button'" [class]="'btn p-0 position-relative d-md-inline-block d-none header-wishlist'"
    [spinner]="false" [id]="'cart_sidebar_btn'" (click)="cartStyle == 'cart_sidebar' && cartToggle(true)"
    *ngIf="style == 'basic'">
    <i class="cil-cart"></i>
    <span class="position-absolute top-0 start-100 translate-middle badge" *ngIf="(cartItem$ | async)?.length">
        {{ (cartItem$ | async)?.length }} <span class="visually-hidden">{{ 'unread_messages' | translate }}</span>
    </span>
</app-button>

<!-- Cart Style Classic -->
<a href="javascript:void(0)" class="header-icon swap-icon" (click)="cartStyle == 'cart_sidebar' && cartToggle(true)"
    *ngIf="style == 'classic'">
    <small class="badge-number badge-light" *ngIf="(cartItem$ | async)?.length">
        {{ (cartItem$ | async)?.length }}
    </small>
    <i class="cil-cart"></i>
</a>

<!-- Modern Cart Sidebar -->
<ng-container *ngIf="!cartHide">
    <div class="modern-cart-sidebar onhover-div" [ngClass]="{ 'fixed-cart': cartStyle == 'cart_sidebar' }"
        [class.show]="(sidebarCartOpen$ | async)">

        <!-- Sidebar Header -->
        <div class="cart-sidebar-header">
            <div class="header-content">
                <h3 class="cart-title">{{ 'Shopping Cart' | translate }}</h3>
                <button type="button" class="close-btn" (click)="cartToggle(false)" aria-label="Close cart">
                    <i class="cil-x"></i>
                </button>
            </div>

            <!-- Free Shipping Progress -->
            <div class="shipping-progress-box" *ngIf="(cartItem$ | async)?.length">
                <div class="progress-info">
                    <span *ngIf="shippingFreeAmt > cartTotal">
                        {{ 'Spend' | translate }} <strong>{{ (shippingFreeAmt - cartTotal) | currencySymbol }}</strong>
                        {{ 'More And Enjoy' | translate }} <strong>{{ 'Free Shipping!' | translate }}</strong>
                    </span>
                    <span *ngIf="shippingFreeAmt <= cartTotal" class="success-text">
                        {{ 'Congratulations! Free Shipping Unlocked' | translate }}
                    </span>
                </div>
                <div class="progress-wrapper">
                    <div class="progress-bar-modern" [ngStyle]="{ width: shippingCal+'%' }">
                        <div class="truck-icon">
                            <i class="cil-truck"></i>
                        </div>
                    </div>
                </div>
            </div>

            <div class="header-actions" *ngIf="(cartItem$ | async)?.length">
                <p class="cart-subtitle">
                    {{ (cartItem$ | async)?.length }} {{ ((cartItem$ | async)?.length == 1 ? 'Product' : 'Products') |
                    translate }}
                </p>
                <button type="button" class="clear-cart-text" (click)="clearCart()">
                    {{ 'Clear cart' | translate }}
                </button>
            </div>
        </div>


        <!-- Cart Items List -->
        <div class="cart-items-container" *ngIf="(cartItem$ | async)?.length">
            <div class="cart-items-list">
                <div class="cart-item-card" *ngFor="let item of cartItem$ | async">
                    <div class="item-image-wrapper">
                        <img [src]="item?.variation && item?.variation?.variation_image
                                ? item?.variation?.variation_image?.original_url
                                : item?.product?.product_thumbnail
                                ? item?.product?.product_thumbnail?.original_url
                                : 'assets/images/product.png'" [alt]="item?.product?.name" class="item-image">
                    </div>

                    <div class="item-details">
                        <div class="name-edit">
                            <h5 class="item-name">
                                {{ item?.variation ? item?.variation?.name : item?.product?.name }}
                            </h5>
                            <div class="mini-actions">
                                <button type="button" class="mini-btn" (click)="VariationModal.openModal(item)"
                                    *ngIf="item?.variation">
                                    <i class="cil-pencil"></i>
                                </button>
                                <button type="button" class="mini-btn" (click)="delete(item.id)">
                                    <i class="cil-trash"></i>
                                </button>
                            </div>
                        </div>

                        <div class="item-price">
                            {{ (item?.variation ? item.variation.sale_price : item?.product && item?.wholesale_price ?
                            item?.wholesale_price : item?.product?.sale_price)! | currencySymbol }}
                        </div>

                        <div class="variation-qty">
                            <p class="item-variation" *ngIf="item?.variation">
                                <span>{{ item?.variation?.selected_variation }}</span>
                            </p>

                            <div class="quantity-controls-mini">
                                <button type="button" class="qty-btn" (click)="updateQuantity(item, -1)">
                                    <i class="cil-trash" *ngIf="item.quantity <= 1"></i>
                                    <i class="cil-minus" *ngIf="item.quantity > 1"></i>
                                </button>
                                <span class="qty-number">{{ item?.quantity }}</span>
                                <button type="button" class="qty-btn" (click)="updateQuantity(item, 1)">
                                    <i class="cil-plus"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Empty Cart State -->
        <div class="empty-cart-state" *ngIf="!(cartItem$ | async)?.length">
            <div class="empty-cart-icon">
                <i class="cil-cart"></i>
            </div>
            <h4>{{ 'Your Cart Is Empty' | translate }}</h4>
            <p>{{ 'Add items to your cart to continue shopping' | translate }}</p>

        </div>

        <!-- Cart Footer -->
        <div class="cart-sidebar-footer" *ngIf="(cartItem$ | async)?.length">
            <div class="cart-total-section">
                <p class="shipping-note">
                    {{ 'Shipping And Taxes Are Calculated At Checkout' | translate }}
                </p>
                <div class="total-row">
                    <span class="total-label">{{ 'Total' | translate }}:</span>
                    <span class="total-value">{{ (cartTotal$ | async)! | currencySymbol }}</span>
                </div>
            </div>

            <div class="cart-action-buttons">
                <a [routerLink]="['/cart']" class="btn btn-view-cart" (click)="cartToggle(false)">
                    {{ 'View Cart' | translate }}
                </a>
                <a [routerLink]="['/checkout']" class="btn btn-checkout" (click)="cartToggle(false)">
                    {{ 'Checkout' | translate }}
                </a>
            </div>
        </div>
    </div>


</ng-container>

<!-- Variation Customize Modal -->
<app-variation-modal #variationModal></app-variation-modal>